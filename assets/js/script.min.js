!function(){"use strict";window.addEventListener("DOMContentLoaded",(function(){if(null==window.wp_api_data)return;const t=window.wp_api_data.wp_nonce,e=window.wp_api_data.donut_rest;!function(){const n=new Headers({Accept:"application/json","X-WP-Nonce":t}),o=new Request(e,{method:"GET",headers:n});fetch(o).then((t=>{if(t.ok)return t.json();throw`Error ${t.status}`})).then((t=>{t.success&&p(t.data)})).catch((t=>{console.error(t)}))}();const n=document.getElementById("app"),o=document.querySelector(".app-stat_table"),s=n.querySelector(".app-overlay__intro"),a=n.querySelector(".app-overlay__settings"),r=n.querySelector("div.annotation-wrapper"),i=n.querySelector(".game-counter"),c=n.querySelectorAll(".win-counter"),d=n.querySelector(".jump-counter"),u=n.querySelector(".game-timer");window.donut={el:document.querySelector("svg.donut"),inRace:!1,get autorun(){return document.getElementById("donut-autorun").checked},get totalGames(){return void 0===this._totalGames?0:this._totalGames},set totalGames(t){this._totalGames=t,i.textContent=t},get totalWins(){return void 0===this._totalWins?0:this._totalWins},set totalWins(t){this._totalWins=t,c.forEach((e=>e.textContent=t))},get totalJumps(){return void 0===this._totalJumps?0:this._totalJumps},set totalJumps(t){this._totalJumps=t,d.textContent=t},get secondsPassed(){return void 0===this._secondsPassed?0:this._secondsPassed},set secondsPassed(t){this._secondsPassed=t;const e=new Date(1e3*t).toISOString().substring(11,19);u.textContent=e},stat:{rockPos:0,rockSize:0,time:0,jumpPos:0,won:0},resetStat:function(){for(const t in this.stat)Object.hasOwnProperty.call(this.stat,t)&&(this.stat[t]=0)},updateStat:function(){this.stat.won="Yay!"===r.textContent,this.stat.won&&this.totalWins++,this.stat.time=Date.now()-this.stat.time,this.totalGames++,function(n){const o=new Headers({Accept:"application/json","X-WP-Nonce":t,"Content-Type":"application/json"}),s=new Request(e,{method:"POST",headers:o,body:JSON.stringify(n)});fetch(s).then((t=>{if(t.ok)return t.json();throw`Error ${t.status}`})).then((t=>{t.success&&p(t.data)})).catch((t=>{console.error(t)}))}(this.stat),this.resetStat(),this.autorun&&window.character.run()},justReseted:!1};new MutationObserver((function(t,e){t.forEach((t=>{const e=parseInt(window.getComputedStyle(window.character.donut).width),n=window.character.characterPosition+e;!donut.inRace&&window.character.characterPosition>0?donut.inRace=!0:donut.inRace&&0===window.character.characterPosition&&(donut.inRace=!1,setTimeout((()=>donut.updateStat()),20)),donut.autorun&&window.character.isRunning&&!window.character.isJumping&&n+3>window.terrain.rockPosition&&n<window.terrain.rockPosition&&(window.character.jump(),donut.totalJumps++),donut.inRace&&window.character.isRunning&&(!donut.stat.jumpPos&&window.character.isJumping&&(donut.stat.jumpPos=window.character.characterPosition),0===donut.stat.rockPos&&(donut.stat.rockPos=window.terrain.rockPosition),0===donut.stat.rockSize&&(donut.stat.rockSize=`${window.terrain.rock.width}x${window.terrain.rock.height}`),0===donut.stat.time&&(donut.stat.time=Date.now()))}))})).observe(donut.el,{attributeFilter:["style"]}),setInterval((function(){n.classList.contains("blur")||(donut.secondsPassed++,donut.justReseted&&donut.secondsPassed>3&&(donut.justReseted=!1))}),1e3);document.getElementById("start-game").addEventListener("click",(t=>{n.classList.remove("blur"),n.querySelector(".app-overlay__intro").classList.add("hide"),window.character.isRunning=!1,window.character.isJumping=!1}),!0);document.getElementById("app-settings").addEventListener("click",(t=>{window.character.stop(),n.classList.add("blur"),a.classList.remove("hide")}));const l=document.getElementById("donut-autorun"),w=n.querySelectorAll(".app-controls > div:not(.app-controls__settings)");l.addEventListener("input",(t=>{w.forEach((t=>t.classList.toggle("hide")))}));document.getElementById("game-resume").addEventListener("click",(t=>{n.classList.remove("blur"),a.classList.add("hide"),donut.autorun&&window.character.run()}));document.getElementById("game-reset").addEventListener("click",(n=>{donut.justReseted||(function(){const n=new Headers({Accept:"application/json","X-WP-Nonce":t}),o=new Request(e,{method:"DELETE",headers:n});fetch(o).then((t=>{if(t.ok)return t.json();throw`Error ${t.status}`})).then((t=>{t.success&&h()})).catch((t=>{console.error(t)}))}(),window.character.stop(),donut.justReseted=!0,donut.inRace=!1,donut.totalGames=0,donut.totalWins=0,donut.totalJumps=0,donut.secondsPassed=0,donut.resetStat(),window.character.donut.style.left=0)}));document.getElementById("donut-stop").addEventListener("click",(t=>{window.character.isRunning&&window.character.stop()}));document.getElementById("donut-run").addEventListener("click",(t=>{window.character.isRunning||window.character.run()})),document.addEventListener("keydown",(t=>{"KeyD"!==t.code||t.repeat||s.classList.contains("hide")||(window.character.isRunning=!0)}));function h(){o.querySelectorAll(".result").forEach((t=>t.remove()))}function p(t){h(),t.forEach((t=>{const e=`<div class="app-stat_table__row result"><p>${t.game_date}</p><p>${t.rock_position} px</p><p>${t.rock_size} px</p><p>${t.jump_position}px</p><p>${t.game_time} ms</p><p class="${t.win}"></p></div>`;o.querySelector(".thead").insertAdjacentHTML("beforebegin",e)}))}document.getElementById("donut-jump").addEventListener("click",(t=>{window.character.isJumping||(window.character.jump(),donut.totalJumps++)})),document.addEventListener("keydown",(t=>{"Space"!==t.code||t.repeat||window.character.isJumping||(s.classList.contains("hide")?donut.totalJumps++:window.character.isJumping=!0)}))}))}();